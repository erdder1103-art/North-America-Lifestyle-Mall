<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>North America Lifestyle Mall â€” $50 Welcome Voucher</title>
  <meta name="description" content="Discover quality lifestyle brands and exclusive offers. Claim your $50 welcome voucher today.">

  <!-- å…¨ç«™è¨­å®šï¼šPixel ID + å¾Œç«¯ API URL -->
  <script>
    const FB_PIXEL_ID = "1879609856327374";
    const ORDER_API_ENDPOINT = "https://script.google.com/macros/s/AKfycbzkEQpk9t5v8fZoqwYR3hM8CESuECYQuM6CBqrk6UdmwiN_IdochhO51hec3eRBszLFtA/exec";
    const CAPI_ENDPOINT = "https://throbbing-grass-6e58.skype138388.workers.dev/";
  </script>

  <!-- ä¸»é‚è¼¯ï¼ˆèªç³»ã€å•†å“ã€è³¼ç‰©è»Šã€é€å–® + eventId + å€’æ•¸ + æ‡¸æµ®è³¼ç‰©è»Šï¼‰ -->
  <script>
  // === å¤šèªç³»å­—ä¸² ===
  const I18N = {
    en: {
      'brand.name': 'North America Lifestyle Mall',

      'ribbon.main': 'ğŸ New users enjoy a $50 welcome voucher. It will be applied automatically at checkout and can be redeemed once per customer.',
      'ribbon.sub': 'Start your curated shopping journey with factory-direct deals and exclusive offers.',
      'ribbon.online': 'ğŸ‘¥ Shoppers online: <span id="onlineCount">--</span>',
      'ribbon.claimed': 'ğŸ”” Vouchers claimed today: <span id="claimCount">--</span>',

      'promo.bar.label': 'âš¡ Last chance! New users limited-time $50 voucher â€“ automatically applied to your cart total. Offer ends in',
      'promo.expired': 'Offer ended',
      'promo.modal.title': 'Last chance: $50 new user voucher',
      'promo.modal.body': 'New users get a one-time $50 voucher that is automatically applied to your cart at checkout. This offer is counting down â€“ once the timer hits 00:00:00, this discount disappears.',
      'promo.modal.timerPrefix': 'Time left in this offer',
      'promo.modal.confirm': 'OK, I will grab it in time',

      'hero.title': 'Your lifestyle, your rewards.',
      'hero.sub': 'Every week we release new limited-time deals. All products are sourced directly from partner factories and brands, cutting out middlemen so you pay less. Feel free to compare prices â€” we let real discounts speak for themselves.',

      'products.heading': 'Featured Picks',

      'cat.gaming': 'Gaming Zone',
      'cat.appliance': 'Home Appliances',

      'btn.addToCart': 'Add to Cart',

      'cart.title': 'Your Cart',
      'cart.empty': 'No items yet. Add products to your cart.',
      'cart.total': 'Total',
      'cart.checkout': 'Checkout',
      'cart.clear': 'Clear',
      'cart.hint': 'At checkout, a $50 welcome voucher will be applied automatically for first-time users while the offer is active.',

      'checkout.title': 'Order & Delivery Details',
      'checkout.selection': 'Your selection',
      'checkout.subtotal': 'Subtotal',
      'checkout.voucher': 'Voucher (up to $50 off)',
      'checkout.final': 'Final amount',
      'checkout.note': 'The voucher is applied automatically if the offer is still active. You enjoy <strong>use now, pay later</strong> with a 7-day trial period â€” if you\'re not satisfied, we can help with returns.',

      'form.fullNameLabel': 'Full Name / Name (must be the buyer)',
      'form.firstNameLabel': 'First Name',
      'form.lastNameLabel': 'Last Name',
      'form.emailLabel': 'Email Address',
      'form.phoneLabel': 'Mobile Phone',
      'form.addressLabel': 'Delivery Address',
      'form.noteLabel': 'Notes (optional)',
      'form.noteBlock': 'Please make sure to fill in your own real name, email, phone number and address. Returns and refunds can only be processed after verifying your personal information to protect your rights. We offer <strong>use now, pay later</strong> and a <strong>7-day trial period</strong>. Your information is used only for this order and customer support, and will not be shared publicly.',
      'form.submit': 'Submit Order',
      'form.back': 'Back to Cart',

      'ph.fullName': 'Please enter your full name',
      'ph.email': 'example@email.com',
      'ph.phone': 'e.g. +1 555 123 4567',
      'ph.address': 'Street, city, state, ZIP',
      'ph.note': 'e.g. preferred delivery time or building access info',

      'footer.textPrefix': 'Â© <span id="year"></span> North America Lifestyle Mall',

      'modal.confirm.title': 'Please confirm your information',
      'modal.confirm.body': 'Please confirm that all information you filled in (name, email, phone and address) belongs to you. Returns and refunds can only be processed after verifying the buyer\'s personal information to protect your rights.',
      'modal.confirm.confirmBtn': 'Yes, this is my information',
      'modal.confirm.editBtn': 'Edit information',

      'modal.success.title': 'Order submitted successfully',
      'modal.success.body': 'Your order has been successfully submitted. We will email your detailed order information within 1â€“3 business days for confirmation.',
      'modal.success.okBtn': 'OK',

      'alert.cartEmpty': 'Your cart is empty, please add items first.',
      'alert.missingFields': 'Please fill in your name, email, phone and delivery address.',
      'alert.networkError': 'Submission failed. Please try again later or contact us for assistance.'
    },
    zh: {
      'brand.name': 'åŒ—ç¾ç”Ÿæ´»ä¼˜é€‰å•†åŸ',

      'ribbon.main': 'ğŸ æ–°ç”¨æˆ·äº«æœ‰ $50 æ¬¢è¿ä¼˜æƒ åˆ¸ï¼Œåœ¨è´­ç‰©è½¦ç»“è´¦æ—¶è‡ªåŠ¨æŠ˜æŠµï¼Œæ¯ä½ç”¨æˆ·é™é¢†ä¸€æ¬¡ã€‚',
      'ribbon.sub': 'å¼€å¯ä½ çš„ç²¾é€‰è´­ç‰©ä¹‹æ—…ï¼Œæ‰€æœ‰å•†å“ç”±åˆä½œå·¥å‚ç›´ä¾›ï¼Œä»·æ ¼é€æ˜æ¬¢è¿æ¯”ä»·ã€‚',
      'ribbon.online': 'ğŸ‘¥ å½“å‰åœ¨çº¿è´­ç‰©äººæ•°ï¼š<span id="onlineCount">--</span>',
      'ribbon.claimed': 'ğŸ”” ä»Šæ—¥å·²é¢†å–ä¼˜æƒ åˆ¸ï¼š<span id="claimCount">--</span>',

      'promo.bar.label': 'âš¡ æœ€åæœºä¼šï¼æ–°ç”¨æˆ·é™æ—¶ $50 ä¼˜æƒ ï¼Œç»“è´¦æ—¶è‡ªåŠ¨æŠ˜æŠµè´­ç‰©è½¦é‡‘é¢ï¼Œä¼˜æƒ å€’æ•°ä¸­ï¼š',
      'promo.expired': 'ä¼˜æƒ å·²ç»“æŸ',
      'promo.modal.title': 'æœ€åæœºä¼šï¼šæ–°ç”¨æˆ·é™æ—¶ $50 ä¼˜æƒ ',
      'promo.modal.body': 'æ–°ç”¨æˆ·äº«æœ‰ä¸€æ¬¡æ€§ $50 æŠ˜æŠµï¼Œç³»ç»Ÿä¼šåœ¨ç»“è´¦æ—¶è‡ªåŠ¨ä»è´­ç‰©è½¦é‡‘é¢æ‰£é™¤ã€‚ä¼˜æƒ æ­£åœ¨å€’æ•°ä¸­ï¼Œä¸€æ—¦æ—¶é—´å½’é›¶ï¼Œè¿™ä¸ªæŠ˜æ‰£å°±ä¼šæ¶ˆå¤±ï¼',
      'promo.modal.timerPrefix': 'æœ¬æ¬¡ä¼˜æƒ å‰©ä½™æ—¶é—´',
      'promo.modal.confirm': 'æˆ‘çŸ¥é“äº†ï¼Œèµ¶å¿«å»é€‰å•†å“',

      'hero.title': 'ä½ çš„ç”Ÿæ´»æ–¹å¼ï¼Œä½ çš„ä¸“å±å›é¦ˆ',
      'hero.sub': 'æ¯å‘¨éƒ½ä¼šæœ‰æ–°çš„ä¼˜æƒ äº§å“é‡Šå‡ºï¼Œæ‰€æœ‰å•†å“çš†ç”±åˆä½œå·¥å‚ä¸å“ç‰Œç›´ä¾›ï¼Œå°‘äº†ä¸­é—´é€šè·¯æˆæœ¬ï¼Œä»·æ ¼æ›´å®åœ¨ã€‚æ¬¢è¿ä½ å¤šæ–¹æ¯”ä»·ï¼Œæˆ‘ä»¬ç”¨çœŸå®æŠ˜æ‰£è¯´è¯ã€‚',

      'products.heading': 'ç²¾é€‰å¥½ç‰©æ¨è',

      'cat.gaming': 'ç”µç«ä¸“åŒº',
      'cat.appliance': 'å®¶ç”µç²¾é€‰',

      'btn.addToCart': 'åŠ å…¥è´­ç‰©è½¦',

      'cart.title': 'è´­ç‰©è½¦',
      'cart.empty': 'è´­ç‰©è½¦ç›®å‰ä¸ºç©ºï¼Œè¯·å…ˆåŠ å…¥å•†å“ã€‚',
      'cart.total': 'åˆè®¡',
      'cart.checkout': 'å»ç»“è´¦',
      'cart.clear': 'æ¸…ç©º',
      'cart.hint': 'ç»“è´¦æ—¶ï¼Œåœ¨ä¼˜æƒ å€’æ•°æœŸé—´çš„æ–°ç”¨æˆ· $50 æ¬¢è¿ä¼˜æƒ åˆ¸ä¼šè‡ªåŠ¨æŠ˜æŠµï¼Œä»…é™é¢†å–ä¸€æ¬¡ã€‚',

      'checkout.title': 'è®¢å•ä¸é…é€èµ„è®¯',
      'checkout.selection': 'æ‚¨çš„é€‰æ‹©',
      'checkout.subtotal': 'å°è®¡',
      'checkout.voucher': 'ä¼˜æƒ åˆ¸ï¼ˆæœ€é«˜å‡ $50ï¼‰',
      'checkout.final': 'åº”ä»˜é‡‘é¢',
      'checkout.note': 'åœ¨ä¼˜æƒ æœ‰æ•ˆæœŸé—´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¥—ç”¨ä¼˜æƒ åˆ¸ã€‚æ‚¨äº«æœ‰<strong>å…ˆä½¿ç”¨åä»˜æ¬¾</strong>ä¸<strong>7 å¤©è¯•ç”¨æœŸ</strong>ï¼Œå¦‚ä¸æ»¡æ„æˆ‘ä»¬å¯ååŠ©é€€è´§ã€‚',

      'form.fullNameLabel': 'Full Name / å§“åï¼ˆé¡»ä¸ºè´­ä¹°äººæœ¬äººï¼‰',
      'form.firstNameLabel': 'åï¼ˆFirst Nameï¼‰',
      'form.lastNameLabel': 'å§“ï¼ˆLast Nameï¼‰',
      'form.emailLabel': 'Email Address / ç”µå­é‚®ç®±',
      'form.phoneLabel': 'Mobile Phone / æ‰‹æœºå·ç ',
      'form.addressLabel': 'Delivery Address / æ”¶è´§åœ°å€',
      'form.noteLabel': 'Notesï¼ˆé€‰å¡«ï¼‰/ å¤‡æ³¨',
      'form.noteBlock': 'è¯·åŠ¡å¿…å¡«å†™<b>æœ¬äººçœŸå®å§“åã€ç”µå­é‚®ç®±ã€æ‰‹æœºå·ç ä¸æ”¶è´§åœ°å€</b>ï¼Œé€€è´§ä¸é€€æ¬¾ä»…èƒ½ä»¥è´­ä¹°è€…æœ¬äººèµ„æ–™åŠç†ï¼Œä»¥ä¿éšœæ‚¨çš„æƒç›Šã€‚æˆ‘ä»¬æä¾›<strong>å…ˆä½¿ç”¨åä»˜æ¬¾</strong>ä¸<strong>7 å¤©è¯•ç”¨æœŸ</strong>ï¼Œæ‚¨çš„èµ„è®¯ä»…ç”¨äºæœ¬æ¬¡è®¢å•ä¸å®¢æœè”ç»œï¼Œä¸ä¼šå¯¹å¤–å…¬å¼€ã€‚',
      'form.submit': 'æäº¤è®¢å•',
      'form.back': 'è¿”å›è´­ç‰©è½¦',

      'ph.fullName': 'è¯·å¡«å†™æ‚¨çš„å§“å',
      'ph.email': 'è¯·è¾“å…¥å¸¸ç”¨ç”µå­é‚®ç®±',
      'ph.phone': 'è¯·å¡«å†™æœ¬äººæ‰‹æœºå·ç ',
      'ph.address': 'è¯¦ç»†æ”¶è´§åœ°å€ï¼ˆè¡—é“ï¼åŸå¸‚ï¼å·ï¼é‚®ç¼–ï¼‰',
      'ph.note': 'ä¾‹å¦‚ï¼šå¸Œæœ›é€è¾¾æ—¶é—´ã€é—¨ç¦æˆ–å¤§æ¥¼å‡ºå…¥è¯´æ˜',

      'footer.textPrefix': 'Â© <span id="year"></span> åŒ—ç¾ç”Ÿæ´»ä¼˜é€‰å•†åŸ',

      'modal.confirm.title': 'ç¡®è®¤æ˜¯å¦ä¸ºæœ¬äººèµ„è®¯',
      'modal.confirm.body': 'è¯·å†æ¬¡ç¡®è®¤æ‚¨å¡«å†™çš„å§“åã€é‚®ç®±ã€æ‰‹æœºä¸æ”¶è´§åœ°å€å‡ä¸ºæœ¬äººçœŸå®èµ„è®¯ã€‚å¦‚éœ€åŠç†é€€è´§æˆ–é€€æ¬¾ï¼Œä»…èƒ½ä»¥è´­ä¹°è€…æœ¬äººèµ„æ–™è¿›è¡Œæ ¸å¯¹ï¼Œä»¥ä¿éšœæ‚¨çš„æƒç›Šã€‚',
      'modal.confirm.confirmBtn': 'ç¡®è®¤ä»¥ä¸Šèµ„è®¯ä¸ºæœ¬äºº',
      'modal.confirm.editBtn': 'è¿”å›ä¿®æ”¹èµ„æ–™',

      'modal.success.title': 'è®¢å•å·²æˆåŠŸé€å‡º',
      'modal.success.body': 'æ‚¨çš„è®¢å•å·²æˆåŠŸæäº¤ï¼Œæˆ‘ä»¬ä¼šåœ¨ 1â€“3 ä¸ªå·¥ä½œå¤©å†…ï¼Œå°†è®¢å•æ˜ç»†å‘é€è‡³æ‚¨çš„ç”µå­é‚®ç®±ä»¥ä¾›ç¡®è®¤ã€‚',
      'modal.success.okBtn': 'æˆ‘çŸ¥é“äº†',

      'alert.cartEmpty': 'è´­ç‰©è½¦ç›®å‰ä¸ºç©ºï¼Œè¯·å…ˆåŠ å…¥å•†å“ã€‚',
      'alert.missingFields': 'è¯·å®Œæ•´å¡«å†™å§“åã€ç”µå­é‚®ç®±ã€æ‰‹æœºå·ç ä¸æ”¶è´§åœ°å€ã€‚',
      'alert.networkError': 'æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»å®¢æˆ·æœåŠ¡ååŠ©ã€‚'
    }
  };

  let currentLang = 'en';
  let currentCategory = 'gaming';
  let isSubmittingOrder = false;
  let currentPurchaseEventId = null;

  // å„ªæƒ å€’æ•¸ï¼ˆ2 å°æ™‚ï¼‰
  let promoEndTime = null; // timestamp(ms)

  function generateEventId(){
    return 'ev_' + Date.now().toString(36) + '_' + Math.random().toString(36).substring(2,10);
  }

  // å°å·¥å…·ï¼šå®‰å…¨å‘¼å« fbq
function fbTrack(eventName, params){
  if(typeof fbq === 'function'){
    fbq('track', eventName, params || {});
  }
}
function fbTrackCustom(eventName, params){
  if(typeof fbq === 'function'){
    fbq('trackCustom', eventName, params || {});
  }
}

// ğŸ”¹ åœ¨é€™è£¡åŠ ã€Œè®€å– FB Cookieã€çš„å°å·¥å…·
function getCookie(name){
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if(parts.length === 2) return parts.pop().split(';').shift();
  return '';
}

  function t(key){
    return (I18N[currentLang] && I18N[currentLang][key]) ||
           (I18N.en && I18N.en[key]) || key;
  }

  function setFooterYear(){
    const y = document.getElementById('year');
    if(y){ y.textContent = new Date().getFullYear(); }
  }

  function applyLanguage(lang){
    currentLang = lang;
    try{
      localStorage.setItem('nm_lang', lang);
    }catch(e){}

    document.querySelectorAll('.lang-btn').forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.lang === lang);
    });

    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.dataset.i18n;
      el.innerHTML = t(key);
    });

    document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
      const key = el.dataset.i18nPlaceholder;
      el.placeholder = t(key);
    });

    setFooterYear();
    renderCategoryTabs();
    renderProductsGrid();
    renderCart();
    updatePromoUI(); // æ–‡å­—æœƒè·Ÿèªè¨€åŒæ­¥
  }

  // é¡åˆ¥ & å•†å“
  const CATEGORIES = [
    { id:'gaming',    number:1, labelKey:'cat.gaming' },
    { id:'appliance', number:2, labelKey:'cat.appliance' },
  ];

  const PRODUCTS = {
    gaming: [
      { id:'gaming1', price:125, image:'./assets/gaming-1.png', alt:'Gaming headset',   nameEn:'ROG Delta II Wireless Gaming Headset',        nameZh:'ROG Delta II æ— çº¿æ¸¸æˆè€³æœº' },
      { id:'gaming2', price:69, image:'./assets/gaming-2.png', alt:'Mechanical kb',    nameEn:'ROG STRIX SCOPE II Gaming Keyboard', nameZh:'ROG STRIX SCOPE II æ¸¸æˆé”®ç›˜' },
      { id:'gaming3', price:83, image:'./assets/gaming-3.png', alt:'Gaming mouse',     nameEn:'ROG KERIS II ORIGIN Wireless Gaming Mouse',    nameZh:'ROG KERIS II ORIGIN æ— çº¿æ¸¸æˆé¼ æ ‡' },
      { id:'gaming4', price:100, image:'./assets/gaming-4.png', alt:'Controller set',   nameEn:'ROG RAIKIRI Wireless Joystick',   nameZh:'ROG RAIKIRI æ— çº¿æ‘‡æ†' },
      { id:'gaming5', price:149, image:'./assets/gaming-5.png', alt:'RGB desk set',     nameEn:'RGB carbon fiber electric height-adjustable desk',        nameZh:'RGBç¢³çº¤ç»´ç”µåŠ¨å‡é™æ¡Œ' },
      { id:'gaming6', price:131, image:'./assets/gaming-6.png', alt:'Streaming mic',    nameEn:'ROG Carnyx Gaming Microphone RGB',      nameZh:'ROG Carnyx RGB æ¸¸æˆéº¦å…‹é£' }
    ],
    appliance: [
    { id:'app1', price:224, image:'./assets/appliance-1.png', alt:'Blender',       nameEn:'JOYOUNG No-Cleaning Multi-Functional Blender',    nameZh:'JOYOUNG-å…æ¸…æ´—å¤šåŠŸèƒ½è°ƒç†æœº' },
    { id:'app2', price:49, image:'./assets/appliance-2.png', alt:'Air fryer',     nameEn:'Cuisinart-Multi-functional air fryer',           nameZh:'Cuisinart-å¤šåŠŸèƒ½ç©ºæ°”ç‚¸é”…' },
    { id:'app3', price:150, image:'./assets/appliance-3.png', alt:'Coffee maker',  nameEn:'OSTER Coffee Machine',      nameZh:'OSTER-å’–å•¡æœº' },
    { id:'app4', price:380, image:'./assets/appliance-4.png', alt:'Vacuum',        nameEn:'Dyson V12s Detect Slim Submarine',   nameZh:'Dyson V12sæ— çº¿å¸å°˜å™¨' }
    ],
  };

  function getProductsForCategory(id){
    return PRODUCTS[id] || [];
  }

  function findProductById(id){
    for(const catId in PRODUCTS){
      const p = PRODUCTS[catId].find(x=>x.id===id);
      if(p) return p;
    }
    return null;
  }

  // Ribbon å‡çµ±è¨ˆ
  function updateOnline(){
    const n = Math.floor(209 + Math.random()*180);
    const el = document.getElementById('onlineCount');
    if(el) el.textContent = n;
  }
  function updateClaim(){
    const n = Math.floor(620 + Math.random()*200);
    const el = document.getElementById('claimCount');
    if(el) el.textContent = n;
  }

  // è³¼ç‰©è»Š
  const cart = {};

  function hasUsedVoucherInBrowser(){
    try{return localStorage.getItem('nm_voucher_used') === '1';}
    catch(e){return false;}
  }
  function markVoucherUsedInBrowser(){
    try{localStorage.setItem('nm_voucher_used','1');}
    catch(e){}
  }

  function updateFloatingCartCount(){
    const countEl = document.getElementById('floatingCartCount');
    if(!countEl) return;
    let totalQty = 0;
    Object.keys(cart).forEach(id=>{
      totalQty += cart[id].qty;
    });
    countEl.textContent = totalQty;
  }

  function renderCart(){
    const container = document.getElementById('cartItems');
    const totalEl = document.getElementById('cartTotal');
    if(!container || !totalEl) return;
    container.innerHTML = '';

    const ids = Object.keys(cart);
    if(!ids.length){
      const empty = document.createElement('div');
      empty.className = 'cart-empty';
      empty.textContent = t('cart.empty');
      container.appendChild(empty);
      totalEl.textContent = '0';
      updateFloatingCartCount();
      return;
    }

    let total = 0;
    ids.forEach(id=>{
      const item = cart[id];
      const linePrice = item.price * item.qty;
      total += linePrice;
      const displayName = currentLang === 'zh' ? item.nameZh : item.nameEn;

      const row = document.createElement('div');
      row.className = 'cart-row';
      row.innerHTML = `
        <div class="cart-row-name">${displayName}</div>
        <div class="cart-row-qty">
          <button type="button" data-id="${id}" data-delta="-1" class="qty-btn">âˆ’</button>
          <span>${item.qty}</span>
          <button type="button" data-id="${id}" data-delta="1" class="qty-btn">+</button>
        </div>
        <div class="cart-row-price">$${linePrice}</div>
      `;
      container.appendChild(row);
    });

    totalEl.textContent = total.toString();

    container.querySelectorAll('.qty-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.dataset.id;
        const delta = parseInt(btn.dataset.delta,10);
        if(cart[id]){
          cart[id].qty += delta;
          if(cart[id].qty <= 0){ delete cart[id]; }
          renderCart();
        }
      });
    });

    updateFloatingCartCount();
  }

  function getCartItemsArray(){
    return Object.keys(cart).map(id=>({
      id,
      nameEn: cart[id].nameEn,
      nameZh: cart[id].nameZh,
      price: cart[id].price,
      qty: cart[id].qty
    }));
  }

  function isPromoActive(){
    return promoEndTime && Date.now() < promoEndTime;
  }

  function getCartTotals(){
    const items = getCartItemsArray();
    let subtotal = 0;
    items.forEach(it=> subtotal += it.price * it.qty);

    const voucherBeforeLimit = Math.min(50, subtotal);
    const voucher = (!hasUsedVoucherInBrowser() && isPromoActive()) ? voucherBeforeLimit : 0;
    const finalTotal = subtotal - voucher;

    return { items, subtotal, voucher, finalTotal };
  }

  function openCheckout(){
    const { items, subtotal, voucher, finalTotal } = getCartTotals();
    if(!items.length){
      alert(t('alert.cartEmpty'));
      return;
    }

    const listEl = document.getElementById('checkoutItemsList');
    const subEl = document.getElementById('checkoutSubtotal');
    const voucherEl = document.getElementById('checkoutVoucher');
    const finalEl = document.getElementById('checkoutFinal');
    if(!listEl || !subEl || !voucherEl || !finalEl) return;

    listEl.innerHTML = '';
    items.forEach(it=>{
      const displayName = currentLang === 'zh' ? it.nameZh : it.nameEn;
      const li = document.createElement('li');
      li.textContent = `${displayName} x${it.qty} ($${it.price})`;
      listEl.appendChild(li);
    });

    subEl.textContent = subtotal.toString();
    voucherEl.textContent = voucher.toString();
    finalEl.textContent = finalTotal.toString();

    const section = document.getElementById('checkoutSection');
    if(section){
      section.classList.remove('hidden');
      section.scrollIntoView({behavior:'smooth'});
    }

    fbTrack('InitiateCheckout',{value:finalTotal,currency:'USD'});
    fbTrackCustom('CheckoutOpen',{subtotal,voucher,finalTotal});
  }

  // Category UI
  function renderCategoryTabs(){
    const container = document.getElementById('categoryTabs');
    if(!container) return;
    container.innerHTML = '';

    CATEGORIES.forEach(cat=>{
      const tab = document.createElement('button');
      tab.type = 'button';
      tab.className = 'category-tab' + (cat.id === currentCategory ? ' active':'');
      tab.dataset.id = cat.id;
      tab.innerHTML = `
        <span class="category-tab-number">${cat.number}</span>
        <span>${t(cat.labelKey)}</span>
      `;
      tab.addEventListener('click', ()=>{
        currentCategory = cat.id;
        try{
          localStorage.setItem('nm_cat', currentCategory);
        }catch(e){}
        renderCategoryTabs();
        renderProductsGrid();
        fbTrackCustom('CategoryClick',{category:cat.id});
      });
      container.appendChild(tab);
    });
  }

  function renderProductsGrid(){
    const grid = document.getElementById('productsGrid');
    if(!grid) return;
    grid.innerHTML = '';

    const products = getProductsForCategory(currentCategory);
    products.forEach(p=>{
      const displayName = currentLang === 'zh' ? p.nameZh : p.nameEn;
      const card = document.createElement('div');
      card.className = 'product';
      card.innerHTML = `
        <img src="${p.image}" alt="${p.alt}">
        <div class="panel">
          <div class="title">${displayName}</div>
          <div class="price">$${p.price}</div>
          <button class="btn add-to-cart" type="button" data-id="${p.id}">
            ${t('btn.addToCart')}
          </button>
        </div>
      `;
      grid.appendChild(card);
    });

    grid.querySelectorAll('.add-to-cart').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.dataset.id;
        const p = findProductById(id);
        if(!p) return;
        if(!cart[id]){
          cart[id] = {
            nameEn:p.nameEn,
            nameZh:p.nameZh,
            price:p.price,
            qty:0
          };
        }
        cart[id].qty += 1;
        renderCart();

        fbTrack('AddToCart',{content_name:p.nameEn,value:p.price,currency:'USD'});
        fbTrackCustom('AddToCartClick',{name:p.nameEn,price:p.price});
      });
    });

    grid.querySelectorAll('.product img').forEach(img=>{
      img.style.cursor = 'zoom-in';
      img.addEventListener('click', ()=>{
        openImageLightbox(img.src, img.alt);
        fbTrackCustom('ImageZoom',{src: img.src});
      });
    });
  }

  // Modal helpers
  function showModal(id){
    const el=document.getElementById(id);
    if(el) el.classList.remove('hidden');
  }
  function hideModal(id){
    const el=document.getElementById(id);
    if(el) el.classList.add('hidden');
  }

  // åœ–ç‰‡ç‡ˆç®±
  function openImageLightbox(src, alt){
    const overlay = document.getElementById('imageLightbox');
    const img = document.getElementById('imageLightboxImg');
    if(!overlay || !img) return;
    img.src = src;
    img.alt = alt || '';
    overlay.classList.remove('hidden');
  }

  function closeImageLightbox(){
    const overlay = document.getElementById('imageLightbox');
    if(overlay){
      overlay.classList.add('hidden');
    }
  }

  let pendingOrderData = null;

  async function actuallySubmitOrder(orderData){
    const finalTotal = (orderData && orderData.totals && orderData.totals.finalTotal)
      ? Number(orderData.totals.finalTotal) || 0
      : 0;

    const eventId = orderData && orderData.eventId ? orderData.eventId : generateEventId();
    currentPurchaseEventId = eventId;

    if(isSubmittingOrder) return;
    isSubmittingOrder = true;

    const submitBtn = document.querySelector('#checkoutForm button[type="submit"]');
    const originalText = submitBtn ? submitBtn.textContent : '';
    if(submitBtn){
      submitBtn.disabled = true;
      submitBtn.textContent = currentLang === 'zh' ? 'æäº¤ä¸­...' : 'Submitting...';
    }

    if(!ORDER_API_ENDPOINT){
      console.log('=== Demo order (no backend configured) ===');
      console.log(orderData);

      if(typeof fbq === 'function'){
        fbq('track','Purchase',
            {value:finalTotal,currency:'USD'},
            {eventID:eventId});
        fbq('track','Lead',
            {value:finalTotal,currency:'USD'},
            {eventID:eventId});
        fbq('trackCustom','OrderSubmitDemo',{finalTotal,eventId});
      }

      showModal('successModal');

      if(submitBtn){
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
      isSubmittingOrder = false;
      return;
    }

    try{
      const payload = Object.assign({}, orderData, { eventId });

      await fetch(ORDER_API_ENDPOINT,{
        method:'POST',
        mode:'no-cors',
        body: JSON.stringify(payload)
      });
// === CAPIï¼šå°‡å¾Œç«¯äº‹ä»¶é€åˆ° Cloudflare Worker ===
try {
  const fbp = getCookie("_fbp") || "";
  const fbc = getCookie("_fbc") || "";

  const capiBody = {
    event_name: "OrderSubmit",
    event_time: Math.floor(Date.now() / 1000),
    event_id: generateEventId(),
    action_source: "website",
    user_data: {
      client_user_agent: navigator.userAgent,
      fbp: fbp,
      fbc: fbc
    },
    custom_data: {
      currency: "USD",
      value: payload?.totals?.finalTotal || 0
    }
  };

  fetch(CAPI_ENDPOINT, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(capiBody)
  });
} catch(e){
  console.error("CAPI ç™¼é€å¤±æ•—", e);
}

      markVoucherUsedInBrowser();

      if(typeof fbq === 'function'){
        fbq('track','Purchase',
            {value:finalTotal,currency:'USD'},
            {eventID:eventId});
        fbq('track','Lead',
            {value:finalTotal,currency:'USD'},
            {eventID:eventId});
        fbq('trackCustom','OrderSubmit',{finalTotal,eventId});
      }

      for(const k in cart){ delete cart[k]; }
      renderCart();
      const form = document.getElementById('checkoutForm');
      if(form) form.reset();

      showModal('successModal');
    }catch(err){
      console.error('Order submit error:',err);
      alert(t('alert.networkError'));
    }finally{
      if(submitBtn){
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
      isSubmittingOrder = false;
    }
  }

  // å€’æ•¸æ™‚é–“æ ¼å¼
  function formatRemaining(ms){
    if(ms < 0) ms = 0;
    const totalSec = Math.floor(ms / 1000);
    const h = String(Math.floor(totalSec / 3600)).padStart(2,'0');
    const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2,'0');
    const s = String(totalSec % 60).padStart(2,'0');
    return `${h}:${m}:${s}`;
  }

  function updatePromoUI(){
    const barTimer = document.getElementById('promoBarTimer');
    const modalTimer = document.getElementById('promoModalTimer');
    const bar = document.getElementById('promoBar');

    if(!promoEndTime){
      if(barTimer) barTimer.textContent = '00:00:00';
      if(modalTimer) modalTimer.textContent = '00:00:00';
      return;
    }

    const now = Date.now();
    const diff = promoEndTime - now;
    const active = diff > 0;

    if(barTimer) barTimer.textContent = active ? formatRemaining(diff) : t('promo.expired');
    if(modalTimer) modalTimer.textContent = active ? formatRemaining(diff) : '00:00:00';

    if(bar){
      if(active){
        bar.classList.remove('promo-expired');
      }else{
        bar.classList.add('promo-expired');
      }
    }
  }

  function initPromoCountdown(){
    try{
      const savedEnd = localStorage.getItem('nm_promo_end');
      if(savedEnd){
        const t = parseInt(savedEnd,10);
        if(!isNaN(t)) promoEndTime = t;
      }
    }catch(e){}

    const now = Date.now();
    if(!promoEndTime || promoEndTime <= now){
      promoEndTime = now + 2 * 60 * 60 * 1000;
      try{
        localStorage.setItem('nm_promo_end', String(promoEndTime));
      }catch(e){}
    }

    updatePromoUI();
    setInterval(updatePromoUI, 1000);

    if(isPromoActive()){
      showModal('promoModal');  // æ¯æ¬¡åˆ·æ–°é¡¯ç¤ºä¸€æ¬¡
    }
  }

  // DOM ready
  document.addEventListener('DOMContentLoaded', ()=>{
    // èªè¨€åˆ‡æ›æŒ‰éˆ•
    document.querySelectorAll('.lang-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const lang = btn.dataset.lang;
        applyLanguage(lang);
        fbTrackCustom('LangSwitch',{lang});
      });
    });

    // åˆå§‹èªè¨€
    let savedLang = 'en';
    try{
      const v = localStorage.getItem('nm_lang');
      if(v === 'en' || v === 'zh') savedLang = v;
    }catch(e){}

    // åˆå§‹é¡åˆ¥
    try{
      const savedCat = localStorage.getItem('nm_cat');
      if(savedCat && PRODUCTS[savedCat]){
        currentCategory = savedCat;
      }else{
        currentCategory = 'gaming';
      }
    }catch(e){
      currentCategory = 'gaming';
    }

    renderCategoryTabs();
    renderProductsGrid();
    renderCart();
    applyLanguage(savedLang);

    setFooterYear();
    updateOnline(); updateClaim();
    setInterval(updateOnline, 10000);
    setInterval(updateClaim, 20000);

    // æ¸…ç©ºè³¼ç‰©è»Š
    const clearBtn = document.getElementById('clearCartBtn');
    if(clearBtn){
      clearBtn.addEventListener('click', ()=>{
        const { items, subtotal } = getCartTotals();
        fbTrackCustom('CartClear',{itemCount:items.length,subtotal});
        for(const k in cart){ delete cart[k]; }
        renderCart();
      });
    }

    // Checkout æŒ‰éˆ•
    const checkoutBtn = document.getElementById('checkoutBtn');
    if(checkoutBtn){
      checkoutBtn.addEventListener('click', openCheckout);
    }

    // è¿”å›è³¼ç‰©è»Š
    const backBtn = document.getElementById('backToCartBtn');
    if(backBtn){
      backBtn.addEventListener('click', ()=>{
        const el = document.getElementById('featured');
        if(el){ el.scrollIntoView({behavior:'smooth'}); }
        fbTrackCustom('BackToCart',{});
      });
    }

    // Hero åœ–ç‰‡æ”¾å¤§
    const heroImg = document.querySelector('.hero .card img');
    if(heroImg){
      heroImg.style.cursor = 'zoom-in';
      heroImg.addEventListener('click', ()=>{
        openImageLightbox(heroImg.src, heroImg.alt || '');
        fbTrackCustom('HeroImageZoom',{src: heroImg.src});
      });
    }

    // è¡¨å–®é€å‡º
    const form = document.getElementById('checkoutForm');
    if(form){
      form.addEventListener('submit',(event)=>{
        event.preventDefault();

        const { items, subtotal, voucher, finalTotal } = getCartTotals();
        if(!items.length){
          alert(t('alert.cartEmpty'));
          return;
        }

        const orderData = {
          firstName: form.firstName.value.trim(),
          lastName:  form.lastName.value.trim(),
          fullName:  (form.firstName.value.trim() + ' ' + form.lastName.value.trim()).trim(),
          phone:   form.phone.value.trim(),
          email:   form.email.value.trim(),
          address: form.address.value.trim(),
          note:    form.note.value.trim(),
          items,
          totals:{ subtotal, voucher, finalTotal },
          createdAt: new Date().toISOString()
        };

        const emailReg = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const phoneDigits = orderData.phone.replace(/\D/g,'');

        if(!emailReg.test(orderData.email)){
          alert(currentLang === 'zh'
            ? 'è¯·å¡«å†™æ­£ç¡®çš„ç”µå­é‚®ç®±æ ¼å¼ã€‚'
            : 'Please enter a valid email address.'
          );
          return;
        }
        if(phoneDigits.length < 8){
          alert(currentLang === 'zh'
            ? 'è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç ã€‚'
            : 'Please enter a valid mobile phone number.'
          );
          return;
        }

        if(!orderData.fullName || !orderData.phone || !orderData.address || !orderData.email){
          alert(t('alert.missingFields'));
          return;
        }

        const eventId = generateEventId();
        orderData.eventId = eventId;

        pendingOrderData = orderData;
        showModal('confirmModal');
      });
    }

    // ç¢ºèªæœ¬äººè³‡è¨Š Modal
    const editInfoBtn = document.getElementById('editInfoBtn');
    if(editInfoBtn){
      editInfoBtn.addEventListener('click', ()=>{
        pendingOrderData = null;
        hideModal('confirmModal');
        fbTrackCustom('OrderEditInfo',{});
      });
    }

    const confirmInfoBtn = document.getElementById('confirmInfoBtn');
    if(confirmInfoBtn){
      confirmInfoBtn.addEventListener('click', async ()=>{
        hideModal('confirmModal');
        if(pendingOrderData){
          const finalTotal = pendingOrderData.totals.finalTotal || 0;
          const eventId = pendingOrderData.eventId || null;
          fbTrackCustom('OrderConfirmInfo',{finalTotal,eventId});
          await actuallySubmitOrder(pendingOrderData);
          pendingOrderData = null;
        }
      });
    }

    // æˆåŠŸ Modal
    const successOkBtn = document.getElementById('successOkBtn');
    if(successOkBtn){
      successOkBtn.addEventListener('click', ()=>{
        hideModal('successModal');
        fbTrackCustom('OrderSuccessModalClose',{});
      });
    }

    // åœ–ç‰‡ç‡ˆç®±é—œé–‰
    const imageLightbox = document.getElementById('imageLightbox');
    const imageLightboxClose = document.getElementById('imageLightboxClose');

    if(imageLightbox){
      imageLightbox.addEventListener('click', (e)=>{
        if(e.target === imageLightbox){
          closeImageLightbox();
        }
      });
    }
    if(imageLightboxClose){
      imageLightboxClose.addEventListener('click', ()=>{
        closeImageLightbox();
      });
    }

    // å„ªæƒ å€’æ•¸ & å½ˆçª—
    initPromoCountdown();

    // å„ªæƒ å½ˆçª—æŒ‰éˆ•
    const promoModalConfirm = document.getElementById('promoModalConfirm');
    if(promoModalConfirm){
      promoModalConfirm.addEventListener('click', ()=>{
        hideModal('promoModal');
        fbTrackCustom('PromoModalConfirm',{});
      });
    }

    // æ‡¸æµ®è³¼ç‰©è»ŠæŒ‰éˆ•
    const floatingCartBtn = document.getElementById('floatingCartBtn');
    if(floatingCartBtn){
      floatingCartBtn.addEventListener('click', ()=>{
        const cartSection = document.querySelector('.cart');
        if(cartSection){
          cartSection.scrollIntoView({behavior:'smooth', block:'center'});
          cartSection.classList.add('cart-highlight');
          setTimeout(()=>cartSection.classList.remove('cart-highlight'), 1000);
        }
      });

      // æ‹–æ›³
      let dragging = false;
      let startX=0, startY=0, startLeft=0, startTop=0;

      floatingCartBtn.addEventListener('mousedown', (e)=>{
        dragging = true;
        startX = e.clientX;
        startY = e.clientY;
        const rect = floatingCartBtn.getBoundingClientRect();
        startLeft = rect.left;
        startTop = rect.top;
        e.preventDefault();
      });

      document.addEventListener('mousemove', (e)=>{
        if(!dragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const newLeft = startLeft + dx;
        const newTop = startTop + dy;
        floatingCartBtn.style.left = newLeft + 'px';
        floatingCartBtn.style.top = newTop + 'px';
        floatingCartBtn.style.right = 'auto';
        floatingCartBtn.style.bottom = 'auto';
      });

      document.addEventListener('mouseup', ()=>{
        dragging = false;
      });
    }

    // ViewContentTimed åœç•™ 30 ç§’
    setTimeout(()=>{
      fbTrackCustom('ViewContentTimed', { seconds: 30 });
    }, 30000);
  });
  </script>

  <!-- Facebook Pixel -->
  <script>
  !(function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)})(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');

  fbq('init', FB_PIXEL_ID);
  fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
         src="https://www.facebook.com/tr?id=1879609856327374&ev=PageView&noscript=1"/>
  </noscript>

  <!-- CSS -->
  <style>
    :root{
      --navy:#0e2144;
      --navy-2:#0a1a36;
      --gold:#d4af37;
      --gold-2:#f0dea7;
      --white:#ffffff;
      --ink:#0b1220;
      --border:rgba(255,255,255,.12);
    }

    *{box-sizing:border-box;}
    html,body{
      margin:0;
      padding:0;
      background:linear-gradient(180deg,var(--navy),var(--navy-2));
      color:var(--white);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      line-height:1.55;
    }
    a{color:var(--gold);text-decoration:none;}
    img{max-width:100%;display:block;}

    .wrap{max-width:1160px;margin:0 auto;padding:20px;}

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:10px 0 14px;
      border-bottom:1px solid var(--border);
    }
    .brand{display:flex;align-items:center;gap:12px;}
    .logo-img{
      width:96px;
      height:96px;
      border-radius:20px;
      object-fit:contain;
      background:transparent;
      padding:0;
    }

    .name{font-weight:800;letter-spacing:.3px;}

    .header-right{
      display:flex;
      align-items:center;
      gap:16px;
    }

    .lang-switch{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .lang-btn{
      display:flex;
      align-items:center;
      gap:4px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:transparent;
      color:#dfe6fb;
      font-size:12px;
      cursor:pointer;
      transition:background .18s ease, color .18s ease, border-color .18s ease;
    }
    .lang-btn .flag{font-size:14px;}
    .lang-btn.active{
      background:var(--gold);
      color:var(--ink);
      border-color:var(--gold);
    }

    .ribbon{
      margin-top:12px;
      background:rgba(212,175,55,.1);
      border:1px solid rgba(212,175,55,.35);
      color:var(--gold-2);
      border-radius:12px;
      padding:10px 14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .ribbon-main{font-size:14px;}
    .ribbon-sub{font-size:12px;opacity:.95;margin-top:2px;display:block;}

    /* å„ªæƒ å€’æ•¸æ©«æ¢ */
    .promo-bar{
      margin-top:10px;
      background:linear-gradient(90deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.18);
      border-radius:999px;
      padding:8px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:13px;
      color:#fef3c7;
    }
    .promo-bar-label{
      margin-right:10px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .promo-bar-timer{
      font-family:ui-monospace,Menlo,Monaco,"SF Mono",Consolas,monospace;
      font-weight:700;
      letter-spacing:1px;
    }
    .promo-bar.promo-expired{
      opacity:.7;
    }

    .hero{
      display:grid;
      gap:20px;
      padding:36px 0 20px;
      grid-template-columns:1.1fr .9fr;
      align-items:center;
    }
    .hero h1{
      font-size:40px;
      line-height:1.15;
      margin:0;
      color:#fff;
    }
    .hero p.sub{
      color:#dfe6fb;
      margin:10px 0 0;
      font-size:17px;
    }
    .hero p.sub span{
      display:block;
      font-size:14px;
      opacity:.9;
      margin-top:4px;
    }

    .section{margin-top:18px;}
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius:16px;
    }
    .panel{padding:16px;}

    .btn{
      appearance:none;
      border:none;
      background:var(--gold);
      color:var(--ink);
      font-weight:800;
      padding:10px 18px;
      border-radius:12px;
      cursor:pointer;
      transition:transform .06s ease,box-shadow .2s ease,background .15s ease;
      font-size:14px;
    }
    .btn.secondary{
      background:transparent;
      color:#fff;
      border:1px solid var(--border);
    }
    .btn-outline{
      background:transparent;
      color:#fff;
      border:1px solid var(--border);
    }
    .btn:active{transform:translateY(1px);}

    .products-layout{
      display:grid;
      grid-template-columns:3fr 1.7fr;
      gap:18px;
      align-items:flex-start;
    }

    .grid-4{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
    }

    .product{
      overflow:hidden;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .product img{
      aspect-ratio:4/3;
      object-fit:cover;
    }
    .product .panel{
      border-top:1px solid var(--border);
      padding:12px 14px 14px;
    }
    .product .title{font-weight:700;font-size:14px;}
    .product .price{color:#ffe7a3;font-size:13px;margin-top:4px;margin-bottom:8px;}

    .category-tabs{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin:10px 0 16px;
    }
    .category-tab{
      display:flex;
      align-items:center;
      gap:6px;
      padding:6px 12px;
      border-radius:999px;
      background:#050818;
      border:1px solid var(--border);
      font-size:13px;
      cursor:pointer;
      color:#e9ecff;
    }
    .category-tab-number{
      width:22px;
      height:22px;
      border-radius:50%;
      background:var(--gold);
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      font-weight:700;
    }
    .category-tab.active{
      background:var(--gold);
      color:var(--ink);
      border-color:var(--gold);
    }
    .category-tab.active .category-tab-number{
      background:#fff;
      color:var(--ink);
    }

    .cart{
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(5,8,20,.9);
      padding:14px;
      position:sticky;
      top:16px;
      transition:box-shadow .25s ease;
    }
    .cart.cart-highlight{
      box-shadow:0 0 0 2px #ffe7a3, 0 0 18px rgba(255,231,163,.7);
    }
    .cart h3{margin:0 0 8px;font-size:16px;}
    .cart-items{
      max-height:260px;
      overflow:auto;
      border-radius:10px;
      background:rgba(255,255,255,.03);
      padding:8px 10px;
      font-size:13px;
    }
    .cart-empty{opacity:.7;}
    .cart-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
      gap:6px;
    }
    .cart-row-name{flex:1;}
    .cart-row-qty{
      display:flex;
      align-items:center;
      gap:4px;
      font-size:12px;
      opacity:.9;
    }
    .cart-row-qty button{
      border-radius:6px;
      border:1px solid var(--border);
      background:transparent;
      color:#fff;
      width:22px;height:22px;
      padding:0;
      cursor:pointer;
    }
    .cart-row-price{
      white-space:nowrap;
      font-size:12px;
    }
    .cart-summary{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      font-size:13px;
      align-items:center;
    }
    .cart-total-amount{
      font-weight:700;
      color:#ffe7a3;
    }
    .cart-actions{
      margin-top:12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .checkout-section{margin-top:22px;}
    .checkout-title{font-size:18px;font-weight:700;margin:0 0 8px;}
    .checkout-summary-box{
      background:rgba(0,0,0,.25);
      border-radius:12px;
      padding:12px 14px;
      font-size:13px;
      margin-bottom:12px;
    }
    .checkout-summary-row{
      display:flex;
      justify-content:space-between;
      margin-bottom:4px;
    }
    .checkout-summary-row.total{margin-top:6px;font-weight:700;}
    .checkout-summary-row.discount{color:#ffe7a3;}
    .checkout-items-list{margin-bottom:8px;padding-left:18px;}
    .checkout-items-list li{margin-bottom:2px;}
    .checkout-note{font-size:12px;opacity:.8;margin-top:4px;}

    .checkout-form-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .checkout-field{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:13px;
    }
    .checkout-field-full{grid-column:1 / -1;}
    .checkout-field label{
      opacity:.9;
      font-size:13px;
    }
    .checkout-field input,
    .checkout-field textarea{
      border-radius:8px;
      border:1px solid var(--border);
      padding:8px 10px;
      font-size:13px;
      background:rgba(0,0,0,.2);
      color:#fff;
      outline:none;
    }
    .checkout-field textarea{
      min-height:70px;
      resize:vertical;
    }

    footer{
      margin:28px 0 18px;
      color:#c6d2ff;
      font-size:13px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:space-between;
      align-items:center;
    }
    .mono{
      font-family:ui-monospace,Menlo,Monaco,"SF Mono",Consolas,monospace;
      font-size:12px;
      color:#b3c2ff;
      word-break:break-all;
    }

    .modal-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1000;
    }
    .modal-card{
      background:linear-gradient(145deg,#15254a,#050818);
      border-radius:18px;
      border:1px solid var(--border);
      max-width:420px;
      width:90%;
      padding:20px 22px 18px;
      box-shadow:0 18px 45px rgba(0,0,0,.6);
    }
    .modal-title{
      font-size:18px;
      font-weight:700;
      margin-bottom:10px;
    }
    .modal-body{
      font-size:14px;
      color:#dfe6fb;
      margin-bottom:16px;
    }
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }
    .modal-btn{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:13px;
      cursor:pointer;
      font-weight:600;
    }
    .modal-btn.primary{
      background:var(--gold);
      color:var(--ink);
    }
    .modal-btn.secondary{
      background:transparent;
      color:#fff;
      border:1px solid var(--border);
    }

    /* å„ªæƒ å½ˆçª— timer å­—é«” */
    #promoModalTimer{
      font-family:ui-monospace,Menlo,Monaco,"SF Mono",Consolas,monospace;
      font-weight:700;
    }

    /* åœ–ç‰‡ç‡ˆç®± */
    .image-lightbox-card{
      position:relative;
      max-width:96vw;
      max-height:90vh;
      padding:0;
      background:transparent;
      border:none;
      box-shadow:none;
    }
    .image-lightbox-card img{
      max-width:96vw;
      max-height:90vh;
      border-radius:16px;
    }
    .image-lightbox-close{
      position:absolute;
      top:10px;
      right:10px;
      width:32px;
      height:32px;
      border-radius:50%;
      border:none;
      background:rgba(0,0,0,.65);
      color:#fff;
      font-size:22px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* æ‡¸æµ®è³¼ç‰©è»ŠæŒ‰éˆ• */
    .floating-cart-btn{
      position:fixed;
      right:24px;
      bottom:20%;
      width:64px;
      height:64px;
      border-radius:50%;
      border:none;
      background:linear-gradient(145deg,#f4c95d,#f6ae2d);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 10px 25px rgba(0,0,0,.35);
      z-index:900;
    }
    .floating-cart-btn .cart-icon{
      font-size:26px;
    }
    .floating-cart-btn .cart-count{
      position:absolute;
      top:-6px;
      right:-6px;
      min-width:22px;
      height:22px;
      border-radius:999px;
      background:#e11d48;
      color:#fff;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
    }

    @media (max-width: 980px){
      .hero{grid-template-columns:1fr;}
      .products-layout{grid-template-columns:1fr;}
      .cart{position:static;}
      .btn{width:100%;}
      .checkout-form-grid{grid-template-columns:1fr;}
      .header-right{flex-direction:column-reverse;align-items:flex-end;}

      .logo-img{
        width:64px;
        height:64px;
      }

      .image-lightbox-card img{
        max-width:100vw;
        max-height:80vh;
      }
    }

    .hidden{display:none;}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <header>
      <div class="brand">
        <img src="./assets/logo.png" alt="North America Mall logo" class="logo-img">
        <div class="name" data-i18n="brand.name"></div>
      </div>
      <div class="header-right">
        <div class="lang-switch">
          <button type="button" class="lang-btn active" data-lang="en">
            <span class="flag">ğŸ‡ºğŸ‡¸</span> EN
          </button>
          <button type="button" class="lang-btn" data-lang="zh">
            <span class="flag">ğŸ‡¨ğŸ‡³</span> ç®€
          </button>
        </div>
      </div>
    </header>

    <!-- Ribbon -->
    <section class="ribbon">
      <div>
        <div class="ribbon-main" data-i18n="ribbon.main"></div>
        <span class="ribbon-sub" data-i18n="ribbon.sub"></span>
      </div>
      <div class="nav">
        <div data-i18n="ribbon.online"></div>
        <div data-i18n="ribbon.claimed"></div>
      </div>
    </section>

    <!-- å„ªæƒ å€’æ•¸æ¢ -->
    <div id="promoBar" class="promo-bar">
      <div class="promo-bar-label" data-i18n="promo.bar.label"></div>
      <div class="promo-bar-timer promo-bar-timer" id="promoBarTimer">02:00:00</div>
    </div>

    <!-- Hero -->
    <section class="hero">
      <div>
        <h1 data-i18n="hero.title"></h1>
        <p class="sub">
          <span data-i18n="hero.sub"></span>
        </p>
      </div>
      <div class="card">
        <img alt="Lifestyle collage" src="./assets/home-7.png" />
      </div>
    </section>

    <!-- Products + Cart -->
    <section id="featured" class="section card">
      <div class="panel products-layout">
        <!-- Products -->
        <div>
          <h3 data-i18n="products.heading"></h3>
          <div id="categoryTabs" class="category-tabs"></div>
          <div id="productsGrid" class="grid-4"></div>
        </div>

        <!-- Cart -->
        <aside class="cart">
          <h3 data-i18n="cart.title"></h3>
          <div id="cartItems" class="cart-items">
            <div class="cart-empty" data-i18n="cart.empty"></div>
          </div>
          <div class="cart-summary">
            <span data-i18n="cart.total"></span>
            <span class="cart-total-amount">$<span id="cartTotal">0</span></span>
          </div>
          <div class="cart-actions">
            <button class="btn" id="checkoutBtn" data-i18n="cart.checkout"></button>
            <button class="btn btn-outline" id="clearCartBtn" type="button" data-i18n="cart.clear"></button>
          </div>
          <p style="font-size:11px;opacity:.75;margin-top:8px;" data-i18n="cart.hint"></p>
        </aside>
      </div>
    </section>

    <!-- Checkout -->
    <section id="checkoutSection" class="section card checkout-section hidden">
      <div class="panel">
        <h3 class="checkout-title" data-i18n="checkout.title"></h3>

        <div class="checkout-summary-box">
          <div style="font-weight:600;margin-bottom:6px;" data-i18n="checkout.selection"></div>
          <ul id="checkoutItemsList" class="checkout-items-list"></ul>

          <div class="checkout-summary-row">
            <span data-i18n="checkout.subtotal"></span>
            <span>$<span id="checkoutSubtotal">0</span></span>
          </div>
          <div class="checkout-summary-row discount">
            <span data-i18n="checkout.voucher"></span>
            <span>- $<span id="checkoutVoucher">0</span></span>
          </div>
          <div class="checkout-summary-row total">
            <span data-i18n="checkout.final"></span>
            <span>$<span id="checkoutFinal">0</span></span>
          </div>
          <div class="checkout-note" data-i18n="checkout.note"></div>
        </div>

        <!-- Form -->
        <form id="checkoutForm">
          <div class="checkout-form-grid">
            <div class="checkout-field">
              <label for="firstName" data-i18n="form.firstNameLabel"></label>
              <input id="firstName" name="firstName" type="text" required
                     data-i18n-placeholder="ph.firstName">
            </div>
            <div class="checkout-field">
              <label for="lastName" data-i18n="form.lastNameLabel"></label>
              <input id="lastName" name="lastName" type="text" required
                     data-i18n-placeholder="ph.lastName">
            </div>
            <div class="checkout-field">
              <label for="email" data-i18n="form.emailLabel"></label>
              <input id="email" name="email" type="email" required
                     data-i18n-placeholder="ph.email">
            </div>
            <div class="checkout-field">
              <label for="phone" data-i18n="form.phoneLabel"></label>
              <input id="phone" name="phone" type="tel" required
                     data-i18n-placeholder="ph.phone">
            </div>
            <div class="checkout-field checkout-field-full">
              <label for="address" data-i18n="form.addressLabel"></label>
              <input id="address" name="address" type="text" required
                     data-i18n-placeholder="ph.address">
            </div>
            <div class="checkout-field checkout-field-full">
              <label for="note" data-i18n="form.noteLabel"></label>
              <textarea id="note" name="note" data-i18n-placeholder="ph.note"></textarea>
            </div>
          </div>

          <p class="checkout-note" data-i18n="form.noteBlock"></p>

          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn" type="submit" data-i18n="form.submit"></button>
            <button class="btn btn-outline" type="button" id="backToCartBtn" data-i18n="form.back"></button>
          </div>
        </form>
      </div>
    </section>

    <!-- Footer -->
    <footer>
      <div data-i18n="footer.textPrefix"></div>
      <div class="mono"></div>
    </footer>
  </div>

  <!-- å„ªæƒ æé†’ Modal -->
  <div id="promoModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-title" data-i18n="promo.modal.title"></div>
      <div class="modal-body">
        <p data-i18n="promo.modal.body"></p>
        <p style="margin-top:8px;font-size:13px;opacity:.9;">
          <span data-i18n="promo.modal.timerPrefix"></span>ï¼š
          <strong id="promoModalTimer">02:00:00</strong>
        </p>
      </div>
      <div class="modal-actions">
        <button type="button" id="promoModalConfirm" class="modal-btn primary" data-i18n="promo.modal.confirm"></button>
      </div>
    </div>
  </div>

  <!-- ç¢ºèªæœ¬äººè³‡è¨Š Modal -->
  <div id="confirmModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-title" data-i18n="modal.confirm.title"></div>
      <div class="modal-body" data-i18n="modal.confirm.body"></div>
      <div class="modal-actions">
        <button type="button" id="editInfoBtn" class="modal-btn secondary" data-i18n="modal.confirm.editBtn"></button>
        <button type="button" id="confirmInfoBtn" class="modal-btn primary" data-i18n="modal.confirm.confirmBtn"></button>
      </div>
    </div>
  </div>

  <!-- é€å‡ºæˆåŠŸ Modal -->
  <div id="successModal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-title" data-i18n="modal.success.title"></div>
      <div class="modal-body" data-i18n="modal.success.body"></div>
      <div class="modal-actions">
        <button type="button" id="successOkBtn" class="modal-btn primary" data-i18n="modal.success.okBtn"></button>
      </div>
    </div>
  </div>

  <!-- åœ–ç‰‡æ”¾å¤§ç‡ˆç®± -->
  <div id="imageLightbox" class="modal-overlay hidden">
    <div class="image-lightbox-card">
      <button type="button" id="imageLightboxClose" class="image-lightbox-close">&times;</button>
      <img id="imageLightboxImg" src="" alt="">
    </div>
  </div>

  <!-- æ‡¸æµ®è³¼ç‰©è»ŠæŒ‰éˆ• -->
  <button id="floatingCartBtn" class="floating-cart-btn" type="button">
    <span class="cart-icon">ğŸ›’</span>
    <span class="cart-count" id="floatingCartCount">0</span>
  </button>
</body>
</html>
